<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="https://mozz.ie/">
    <title>广东联通 IPTV 鉴权&amp;抓源脚本（以及碎碎念） - 蚊帐</title>
    <meta name="description"
        content="效果和用途同上一篇一样，只不过换成了联通的，两家的架构大差不差。至于我为什么从电信换成了联通，请看正文">
    
    
    <meta name="author" content="mozzie">
    
    
    
    
    
    <link rel="stylesheet" href="/scss/style.min.96a20e69193e20e98b419c09023a453e83dc8f144843da3c6451726c3e3ff162.css">
    <link rel="icon" type="image/x-icon" href="/img/icon.png">
    <meta name="view-transition" content="same-origin">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

    
    <meta property="og:title" content="广东联通 IPTV 鉴权&amp;抓源脚本（以及碎碎念）" />
<meta property="og:description" content="效果和用途同上一篇一样，只不过换成了联通的，两家的架构大差不差。至于我为什么从电信换成了联通，请看正文" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mozz.ie/posts/gdcu-iptv-playlist/" /><meta property="og:image" content="https://mozz.ie/img/cover1.jpg" />
<meta property="og:site_name" content="蚊帐" /><meta property="article:published_time" content="2024-10-27T00:00:00&#43;00:00" /><meta property="article:modified_time" content="2024-10-30T00:00:00&#43;00:00" />
<meta property="article:section" content="技术" />
    
</head>

<body>
    

<div class="container" id="container">
    <div class="bean bean-main">
    <div class="avatar">
        <img src="/img/icon.png" alt="蚊帐">
    </div>
    <div class="blog-name">蚊帐</div>
    <div class="links">
        <a class="link-item " href="/">
            <div class="link-container">
                <span class="link-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none"><path d="M7.5 2.75a.75.75 0 0 0-1.5 0v3a1.75 1.75 0 0 0 1.543 1.738L6.527 9.993a3.868 3.868 0 0 0 .119 3.143l3.99 7.95c.149.298.363.535.614.693V12.3a1.5 1.5 0 1 1 1.5 0v9.48c.251-.158.465-.395.615-.692l3.99-7.951c.481-.96.526-2.137.118-3.143l-1.016-2.505A1.75 1.75 0 0 0 18 5.75v-3a.75.75 0 0 0-1.5 0v3a.25.25 0 0 1-.25.25h-8.5a.25.25 0 0 1-.25-.25v-3z" fill="currentColor"></path></g></svg></span>
                <span class="link-text">&nbsp;文章</span>
            </div>
        </a>
        
        <a class="link-item " href="/categories/%e6%8a%80%e6%9c%af/">
            <div class="link-container">
                <span class="link-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><g fill="none"><path d="M11 1a4 4 0 0 0-3.896 4.91l-5.051 5.235a1.986 1.986 0 0 0 2.842 2.774l5.007-5.072a4.002 4.002 0 0 0 5.062-4.382a.5.5 0 0 0-.85-.287L12 6.293L9.707 4l2.115-2.115a.5.5 0 0 0-.287-.85A4.032 4.032 0 0 0 10.999 1z" fill="currentColor"></path></g></svg></span>
                <span class="link-text">&nbsp;技术</span>
            </div>
        </a>
        
        <a class="link-item " href="/categories/%E6%97%A5%E5%B8%B8/">
            <div class="link-container">
                <span class="link-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><path d="M21.05 17.56l-17.97.94L3 17l17.98-.94l.07 1.5zM21 19.48H3v1.5h18v-1.5zM22 5v7c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2zm-2 1c-1.68 0-3.04.98-3.21 2.23c-.64-.73-2.73-2.73-6.54-2.73c-4.67 0-6.75 3-6.75 3s2.08 3 6.75 3c3.81 0 5.9-2 6.54-2.73C16.96 10.02 18.32 11 20 11V6z" fill="currentColor"></path></svg></span>
                <span class="link-text">&nbsp;日常</span>
            </div>
        </a>
        
        <a class="link-item " href="/links/">
            <div class="link-container">
                <span class="link-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32"><path d="M29.25 6.76a6 6 0 0 0-8.5 0l1.42 1.42a4 4 0 1 1 5.67 5.67l-8 8a4 4 0 1 1-5.67-5.66l1.41-1.42l-1.41-1.42l-1.42 1.42a6 6 0 0 0 0 8.5A6 6 0 0 0 17 25a6 6 0 0 0 4.27-1.76l8-8a6 6 0 0 0-.02-8.48z" fill="currentColor"></path><path d="M4.19 24.82a4 4 0 0 1 0-5.67l8-8a4 4 0 0 1 5.67 0A3.94 3.94 0 0 1 19 14a4 4 0 0 1-1.17 2.85L15.71 19l1.42 1.42l2.12-2.12a6 6 0 0 0-8.51-8.51l-8 8a6 6 0 0 0 0 8.51A6 6 0 0 0 7 28a6.07 6.07 0 0 0 4.28-1.76l-1.42-1.42a4 4 0 0 1-5.67 0z" fill="currentColor"></path></svg></span>
                <span class="link-text">&nbsp;链接</span>
            </div>
        </a>
        
        <a class="link-item " href="/about/">
            <div class="link-container">
                <span class="link-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32"><path d="M25 10l1.593 3l3.407.414l-2.5 2.253L28 19l-3-1.875L22 19l.5-3.333l-2.5-2.253L23.5 13l1.5-3z" fill="currentColor"></path><path d="M22 30h-2v-5a5.006 5.006 0 0 0-5-5H9a5.006 5.006 0 0 0-5 5v5H2v-5a7.008 7.008 0 0 1 7-7h6a7.008 7.008 0 0 1 7 7z" fill="currentColor"></path><path d="M12 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path></svg></span>
                <span class="link-text">&nbsp;关于</span>
            </div>
        </a>
        
    </div>
    <div class="meta-info">
        <span class="show">Mozzie © 2025<br />Made With ♥</span>
        <span class="hide">Theme Candy 2 By <a href="https://github.com/Archeb/candy2-hugo">Candy2-Hugo</a></span>
    </div>
</div>
    <div id="contained-containers" class="contained-containers">
        <div class="contained-beans">
            
                        <a href="https://mozz.ie/posts/xiaomi-yu7-experience/" class="bean bean-article" style="background-image: url('/assets/Xiaomi-YU7-experience/image-20251204230236060.png');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2025年12月4日</div>
        </div>
        <div class="category-item">
            <div class="item-text">日常</div>
        </div>
    </div>
    <div class="article-title">
        <span>小米 YU7 三个月驾乘体验</span>
        <div class="article-summary">
            男人最快乐的事，大概就是在合适的年龄，买了那台不会后悔的车。
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/wdm-custom-combo-boardband/" class="bean bean-article" style="background-image: url('/assets/wdm-custom-combo-boardband/xgspon3A_764X452.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2025年4月19日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>波分单线复用笑传之Custom Combo Broadband</span>
        <div class="article-summary">
            只要一个￥38的波分复用器，巧妙解决小区单线入户但想多运营商接入的老生常谈问题
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/homeassistant-integration-writeup/" class="bean bean-article" style="background-image: url('/assets/homeassistant-integration-writeup/photo_2025-03-22_01-05-25.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2025年3月22日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>新柏石KNX协议智能家居网关接入 HomeAssistant</span>
        <div class="article-summary">
            只需要一根网线和一些小技巧，将开发商精装送的全屋智能设备接入HA，同时完整保留对原有系统的兼容，不具侵入性。
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/dual-cgnat-routeros-wireguard-tunnel/" class="bean bean-article" style="background-image: url('/img/cover1.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2025年1月24日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>双方无公网状态下 RouterOS 基于 WireGuard 的组网方案</span>
        <div class="article-summary">
            双方无公网但其中一方是 Full Cone NAT，这种情况下如何用 RouterOS 组网？要解决这个问题，你需要一台 Linux（或者容器）来帮路由器打洞。
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/gdcu-iptv-playlist/" class="bean bean-article" style="background-image: url('/img/cover1.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2024年10月27日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>广东联通 IPTV 鉴权&amp;抓源脚本（以及碎碎念）</span>
        <div class="article-summary">
            效果和用途同上一篇一样，只不过换成了联通的，两家的架构大差不差。至于我为什么从电信换成了联通，请看正文
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/gdct-iptv-auth-and-fetch-playlist/" class="bean bean-article" style="background-image: url('/img/cover1.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2023年6月25日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>广东电信 IPTV 自助鉴权 &#43; 获取播放列表</span>
        <div class="article-summary">
            懒得每次失效都要重新抓包了，研究发现可以重放鉴权包，现在可以在电脑完成整个过程了
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/why-not-pon-fttr/" class="bean bean-article" style="background-image: url('/assets/why-not-pon-fttr/large-20220408_banner_cms_webinar_ftth-rollout_760x428.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2023年5月7日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>为什么我们要拒绝 PON 方案的 FTTR</span>
        <div class="article-summary">
            “FTTR 是一套很神奇的几乎没有任何优点的方案。很少见到这样全是缺点几乎没优点的方案”
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/turn-windows-11-into-server-2022/" class="bean bean-article" style="background-image: url('/assets/turn-windows-11-into-server-2022/Snipaste_2023-01-02_11-57-49.png');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2023年1月2日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>把 Windows 11/10 不完全转换为 Windows Server 2022</span>
        <div class="article-summary">
            当你想使用一些 Windows Server 专属功能的时候，你也许想要这么做。比如我打算用的 DDA （Discrete Device Assignment）功能。本文不涉及关于如何激活的内容，请自备许可证。
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/usb-ecm-and-ipv6-for-openstick/" class="bean bean-article" style="background-image: url('/assets/usb-ecm-and-ipv6-for-openstick/photo_2022-10-04_18-29-37.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2022年10月5日</div>
        </div>
        <div class="category-item">
            <div class="item-text">日常</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>高通410随身WiFi的进阶USB网络共享和IPv6配置</span>
        <div class="article-summary">
            主要包括 USB CDC-ECM 的配置以让它被 RouterOS 识别，还有基于 ND Proxy 的 IPv6 共享
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/thinkbook-14-g4&#43;ara-amd-ryzen-hands-on/" class="bean bean-article" style="background-image: url('/assets/ThinkBook-14-G4&#43;ARA-AMD-Ryzen-Hands-On/image-20220802032903453.png');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2022年8月1日</div>
        </div>
        <div class="category-item">
            <div class="item-text">日常</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>ThinkBook 14&#43; 锐龙版上手体验</span>
        <div class="article-summary">
            2022年，史称6800H年。
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/experience-summary-for-arch-and-kde/" class="bean bean-article" style="background-image: url('/assets/8854314f89b9e34d7201c.png');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2022年6月27日</div>
        </div>
        <div class="category-item">
            <div class="item-text">日常</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>ArchLinux &#43; KDE 一周使用小结</span>
        <div class="article-summary">
            蚊子の第二次 Linux 挑战，堂堂开幕！
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/fix-fractional-scaling-edge-chrome-position/" class="bean bean-article" style="background-image: url('/assets/images/2021/11/----_gjs_20211127130445.png.webp');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2021年11月27日</div>
        </div>
        <div class="category-item">
            <div class="item-text">日常</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
        <div class="category-item">
            <div class="item-text">水</div>
        </div>
    </div>
    <div class="article-title">
        <span>修复 Edge/Chrome 在 GNOME 分数缩放下的窗口位置问题</span>
        <div class="article-summary">
            从上周开始，老莱弄了个“Daily Driver CHALLENGE”，然后我也跟了一波风
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/extracting-iptv-live-streams/" class="bean bean-article" style="background-image: url('/img/cover1.jpg');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2021年4月12日</div>
        </div>
        <div class="category-item">
            <div class="item-text">日常</div>
        </div>
        <div class="category-item">
            <div class="item-text">网络</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>轻松抓取并解析广东电信 IPTV 全部直播源</span>
        <div class="article-summary">
            老爸说想在卧室看电视，网上的电视直播软件大多都不怎么稳定，还有广告。而 GitHub 上的 IPTV 项目里的源清晰度也都不咋地。自己动手，丰衣足食，自己从机顶盒里抓吧！
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/ultimate-virtual-monitor-solution-indirect-display/" class="bean bean-article" style="background-image: url('/assets/images/2021/04/----1.png.webp');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2021年4月11日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
    </div>
    <div class="article-title">
        <span>虚拟显示器终极解决方案 IndirectDisplay</span>
        <div class="article-summary">
            自从上了大学，因为学校在珠海家在广州距离不算远，所以我经常两头跑。别人两头跑带个笔记本也就好了；我虽
        </div>
    </div>
</a>
                        
                        <a href="https://mozz.ie/posts/pve-based-home-network/" class="bean bean-article" style="background-image: url('/assets/images/size/w1000/2021/03/image.png.webp');">
    <div class="article-category">
        <div class="category-item">
            <div class="item-text">2021年3月6日</div>
        </div>
        <div class="category-item">
            <div class="item-text">技术</div>
        </div>
        <div class="category-item">
            <div class="item-text">网络</div>
        </div>
    </div>
    <div class="article-title">
        <span>基于PVE的新网络架构 - 踩坑回顾</span>
        <div class="article-summary">
            用 LXC 容器来跑 OpenWRT 虽然很香，但也有一些坑。
        </div>
    </div>
</a>
                        
                        <div class="bean-space"></div>
                    </div>
                </div>
            </div>

            
            <div class="modal"
                style="visibility: visible; background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(20px);">
                <div class="article-toc">
                    <nav id="TableOfContents"></nav>
                </div>
                <div class="modal-visible-container">
                <div class="bean bean-read" style="transform: translate(0, 0);">
                    <div class="modal-close">×</div>
                    <div class="article-cover"
                        style="background-image: url('/img/cover1.jpg');">
                        <div></div>
                        <div class="article-title">
                            广东联通 IPTV 鉴权&amp;抓源脚本（以及碎碎念）
                            <div class="article-category">
                                
                                <div class="category-item">
                                    <div class="item-text">技术</div>
                                </div>
                                
                                
                            </div>
                        </div>
                    </div>
                    <div class="article-banner">
                        <div id="banner-progressbar"></div>
                        <div class="banner-content">
                            
                            <div class="banner-author">
                                
                                <div class="author-avatar">
                                    <img src="/img/icon.png" alt="mozzie">
                                </div>
                                
                                <span class="author-name">mozzie</span>
                                <span class="publish-time">2024年10月27日</span>
                                <span class="small-title">广东联通 IPTV 鉴权&amp;抓源脚本（以及碎碎念）</span>
                            </div>
                            <div class="banner-tools">
                                <span class="reading-time">阅读共需 2 分钟</span>
                            </div>
                        </div>
                        <div class="mobile-close-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32">
                                <path
                                    d="M24 9.4L22.6 8L16 14.6L9.4 8L8 9.4l6.6 6.6L8 22.6L9.4 24l6.6-6.6l6.6 6.6l1.4-1.4l-6.6-6.6L24 9.4z"
                                    fill="currentColor"></path>
                            </svg></div>
                    </div>
                    <div class="article-content">
                        <blockquote>
<p>好久不见，大家最近的网上冲浪生活过得如何？本来有很多次都想写博客，但是每当我准备动笔的时候我都不禁有，我即将要写的这个话题对读者有用吗？他们会喜欢看我的碎碎念吗？这么流水账的东西，还是不要写了吧……等种种念头，最终又导致我偷懒。那么总算是有一些可能对大家有用的东西，借着这个由头，我写下了这篇文章。</p>
</blockquote>
<p>首先讲一下目前家里网络的配置吧。在下述事件发生的时间点，我家里有5个运营商的入户线，并且办理了5个宽带帐户，分别是：</p>
<ul>
<li>广东电信（169元普通融合套餐 1000/100 公网+IPTV、290元CN2游戏宽带 无公网）</li>
<li>广东联通（180元商务极光1000/300 公网、38元三折冰淇淋 500/50 无公网）</li>
<li>广东移动（79元芒果卡 500/50 无公网）</li>
<li>广东广电（有入户线未安装）</li>
<li>长城宽带（有入户线未安装）</li>
</ul>
<p>广东电信最近在疯狂的以打击PCDN之名关停大流量宽带的公网IP，并且将这些用户都拉到深圳出口，NAT类型为Symmetric。坊间称为广东电信NAT4竞技场事件。意料之中的是，我也被牵连了——因为我确实有跑PCDN，具体的表现是：MTU 变成 1430，IPv4 分到 100.64 的 CGNAT IP，IPv6 不能入站+半小时变一次。具体的事件可以看<a href="https://www.v2ex.com/t/1079783">这个</a>和<a href="https://www.v2ex.com/t/1082313#reply110">这个</a>帖子，在文章里就不展开讲了。与选择硬刚电信到底的网友不同，我对我家这条 169/月 1000/100 带公网的电信的态度一直是能让我跑我就跑，给我掐了我也愿赌服输。所以我麻利地带上光猫去营业厅办理了销户，然后转头就到隔壁的联通营业厅加开了IPTV业务。为什么是联通？因为电信和移动单独加IPTV都要20元一个月，而联通只要10元一个月，我也不知道为什么他们那么贵。</p>
<p>师傅非常敬业地快速来安装了，盒子型号是数码视讯TR100。由于广东联通一直以来的摆烂态度，IPTV这种业务他们肯定是完全不上心的（不然也不会必须到营业厅办理），所以机顶盒中一个广告也没有，甚至连电信/移动标配的增值业务包也没有，非常干净。而相对的，就是节目源的缺乏——我扫了一眼频道列表，就发现了没有本地台、高清卫视台只有7个、各种频道的回看缺失（在后面把源提取出来之后，竟然实际上能看）等种种问题。当然这些问题也无伤大雅，反正真正看的就那么几个台。</p>
<p>抓源的过程非常简单，我也做了一个小脚本方便进行鉴权和频道整理，以下是流程：</p>
<ol>
<li>
<p>按照<a href="https://mozz.ie/posts/extracting-iptv-live-streams/">前文的方法</a>抓取完整过程的包，然后这次搜索 分组字节流-字符串 输入 <code>grant_type=EncryToken</code>
<img src="/assets/gdcu-iptv-playlist/image-20241030215024704.png" alt="image-20241030215024704"></p>
</li>
<li>
<p>在数据包详情里面滚动到最下面，有一个Full request URI，右键 复制-值，就可以获得完整的鉴权 URL
<img src="/assets/gdcu-iptv-playlist/image-20241030215209212.png" alt="image-20241030215209212"></p>
</li>
<li>
<p>替换以下脚本中的鉴权URL，并把脚本保存为 iptv.py</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置工作目录为脚本所在目录</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>chdir(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(__file__)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;User-Agent&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;okhttp/3.10.0&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取所有频道信息</span>
</span></span><span style="display:flex;"><span>all_channels_response <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;http://120.87.12.38:8083/epg/api/custom/getAllChannel.json&#34;</span>)
</span></span><span style="display:flex;"><span>all_channels_data <span style="color:#f92672">=</span> all_channels_response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> all_channels_data[<span style="color:#e6db74">&#39;status&#39;</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;200&#39;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;channels&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> all_channels_data:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;错误：无法获取频道列表或频道列表格式错误。&#34;</span>)
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取频道代码</span>
</span></span><span style="display:flex;"><span>channel_codes <span style="color:#f92672">=</span> [channel[<span style="color:#e6db74">&#39;params&#39;</span>][<span style="color:#e6db74">&#39;hwcode&#39;</span>] <span style="color:#66d9ef">for</span> channel <span style="color:#f92672">in</span> all_channels_data[<span style="color:#e6db74">&#39;channels&#39;</span>] <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;params&#39;</span> <span style="color:#f92672">in</span> channel <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;hwcode&#39;</span> <span style="color:#f92672">in</span> channel[<span style="color:#e6db74">&#39;params&#39;</span>]]
</span></span><span style="display:flex;"><span>channel_codes_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span><span style="color:#f92672">.</span>join(channel_codes)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取访问令牌</span>
</span></span><span style="display:flex;"><span>token_response <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;这里替换鉴权URL，可能IP地址不同，请确保同时修改下面的IP&#34;</span>)
</span></span><span style="display:flex;"><span>access_token <span style="color:#f92672">=</span> token_response<span style="color:#f92672">.</span>json()<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;access_token&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> access_token:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;错误：未能获取有效的 access token。&#34;</span>)
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用访问令牌请求数据</span>
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Authorization&#39;</span>: access_token,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;User-Agent&#39;</span>: <span style="color:#e6db74">&#39;okhttp/3.10.0&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Connection&#39;</span>: <span style="color:#e6db74">&#39;Keep-Alive&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#39;application/json;charset=utf-8&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps({<span style="color:#e6db74">&#34;channelcodes&#34;</span>: channel_codes_str})
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 请修改此处IP，确保与鉴权URL的IP一致</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(<span style="color:#e6db74">&#34;http://120.87.11.25:33200/EPG/interEpg/channellist/batch&#34;</span>, headers<span style="color:#f92672">=</span>headers, data<span style="color:#f92672">=</span>data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> response<span style="color:#f92672">.</span>json():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;错误：返回的数据为空。&#34;</span>)
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存响应数据到文件</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;iptv.json&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    json<span style="color:#f92672">.</span>dump(response<span style="color:#f92672">.</span>json(), f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 复制 base.txt 到 iptv.txt</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;base.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>) <span style="color:#66d9ef">as</span> f_base, open(<span style="color:#e6db74">&#39;iptv.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span> ,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>) <span style="color:#66d9ef">as</span> f_iptv:
</span></span><span style="display:flex;"><span>    f_iptv<span style="color:#f92672">.</span>write(f_base<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取 iptv.json 并处理数据</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;iptv.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;channellist&#39;</span>):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;错误：&#39;channellist&#39; 数据为空。&#34;</span>)
</span></span><span style="display:flex;"><span>        sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    channels <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#39;channellist&#39;</span>]:
</span></span><span style="display:flex;"><span>        hwcode <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#39;channelcode&#39;</span>]
</span></span><span style="display:flex;"><span>        channel_info <span style="color:#f92672">=</span> next((ch <span style="color:#66d9ef">for</span> ch <span style="color:#f92672">in</span> all_channels_data[<span style="color:#e6db74">&#39;channels&#39;</span>] <span style="color:#66d9ef">if</span> ch[<span style="color:#e6db74">&#39;params&#39;</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;hwcode&#39;</span>) <span style="color:#f92672">==</span> hwcode), <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> channel_info:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        channel_name <span style="color:#f92672">=</span> channel_info[<span style="color:#e6db74">&#39;title&#39;</span>]
</span></span><span style="display:flex;"><span>        timeshift_url <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#39;timeshifturl&#39;</span>]
</span></span><span style="display:flex;"><span>        group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;其它&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;CCTV&#34;</span> <span style="color:#f92672">in</span> channel_name <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;CGTN&#34;</span> <span style="color:#f92672">in</span> channel_name:
</span></span><span style="display:flex;"><span>            group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;央视&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> any(x <span style="color:#f92672">in</span> channel_name <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#34;广东&#34;</span>, <span style="color:#e6db74">&#34;广州&#34;</span>, <span style="color:#e6db74">&#34;大湾区&#34;</span>, <span style="color:#e6db74">&#34;南方&#34;</span>, <span style="color:#e6db74">&#34;岭南&#34;</span>]):
</span></span><span style="display:flex;"><span>            group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;广东&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;卫视&#34;</span> <span style="color:#f92672">in</span> channel_name:
</span></span><span style="display:flex;"><span>            group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;卫视&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> group:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> group <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> channels:
</span></span><span style="display:flex;"><span>                channels[group] <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            channels[group]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>channel_name<span style="color:#e6db74">}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{</span>timeshift_url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 写入处理后的数据到 iptv.txt</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;iptv.txt&#39;</span>, <span style="color:#e6db74">&#39;a&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> group, ch_list <span style="color:#f92672">in</span> channels<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">,#genre#</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> channel <span style="color:#f92672">in</span> ch_list:
</span></span><span style="display:flex;"><span>                f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>channel<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div></li>
<li>
<p>在同目录新建一个 base.txt，放你需要的其他频道列表（比如我放了一些其他节目源），如果没有就新建一个 base.txt 然后里面什么都不写即可。</p>
</li>
<li>
<p>运行 iptv.py，它会在同目录下生成符合DIYP影音格式的 iptv.txt。</p>
</li>
<li>
<p>如果需要修改分组规则或者排除非高清频道，请自行问 AI 让他帮你改脚本里的分类代码。</p>
</li>
</ol>
<p>那么通过以上的脚本我们就稳定实现了电视节目源的自动更新，并且可以将它提取出来在任何有广东联通出口的网络上看啦（联通仍未像电信那样禁止在公网看IPTV，好！）</p>

                    </div>
                    
                </div>
                    
                    
                        <div class="bean article-comment article-comment-hidden">
                            <div class="comment-container">
                            <div id="gitalk-container"></div>
<script>
var href = new URL(window.location.href).pathname.split("/");
var slug = href[href.length - 1] != "" ? href[href.length - 1] : href[href.length - 2]
new Gitalk({
  clientID: "fb4a07f44c3d7b079399",
  clientSecret: "08adb9b8b4da92a812adb7257412c9efff4f92f4",
  repo: "Blog-Comments",
  owner: "Archeb",
  admin: ["Archeb"],
  proxy: "https://corsproxy.gfw.moe/corsproxy/?apiurl=https://github.com/login/oauth/access_token",
  id: slug, 
  distractionFreeMode: false, 
}).render('gitalk-container')
</script>

                            </div>
                        </div>
                    
                </div>
                <div class="bean-tools">
                    <div class="tool-btn" id="btn-top" title="回到顶部"
                        onclick="document.querySelector('.bean-read').scrollTo({top: 0, behavior: 'smooth'})">
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
                            <path
                                d="M519.4 242.8l263.8 333.4c14.6 18.4 1.4 45.8-22.2 45.8H263c-23.6 0-36.8-27.4-22.2-45.8l263.8-333.4c10.4-13.2 30.4-13.2 40.8 0z"
                                fill="currentColor" />
                        </svg>
                    </div>
                    
                    <div class="tool-btn" id="btn-comment" title="查看评论"
                        onclick="toggleComments()">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
                            <path
                                d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H6L4 18V4H20V16Z"
                                fill="currentColor" />
                        </svg>
                    </div>
                    
                    <div class="tool-btn" id="btn-share" title="分享"
                        onclick="navigator.share({title: document.title, url: window.location.href})">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
                            <path
                                d="M18 16.08C17.24 16.08 16.56 16.38 16.04 16.85L8.91 12.7C8.96 12.47 9 12.24 9 12C9 11.76 8.96 11.53 8.91 11.3L15.96 7.19C16.5 7.69 17.21 8 18 8C19.66 8 21 6.66 21 5C21 3.34 19.66 2 18 2C16.34 2 15 3.34 15 5C15 5.24 15.04 5.47 15.09 5.7L8.04 9.81C7.5 9.31 6.79 9 6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15C6.79 15 7.5 14.69 8.04 14.19L15.16 18.34C15.11 18.55 15.08 18.77 15.08 19C15.08 20.61 16.39 21.92 18 21.92C19.61 21.92 20.92 20.61 20.92 19C20.92 17.39 19.61 16.08 18 16.08Z"
                                fill="currentColor" />
                        </svg>
                    </div>
                </div>
            </div>
            
    <script src="/js/candy2.js"></script>
</body>

</html>