<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on 蚊帐</title>
    <link>https://mozz.ie/posts/</link>
    <description>Recent content in Posts on 蚊帐</description>
    <generator>Hugo</generator>
    <language>zh-CN</language>
    <lastBuildDate>Sat, 19 Apr 2025 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://mozz.ie/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>波分单线复用笑传之Custom Combo Broadband</title>
      <link>https://mozz.ie/posts/wdm-custom-combo-boardband/</link>
      <pubDate>Sat, 19 Apr 2025 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/wdm-custom-combo-boardband/</guid>
      <description>&lt;p&gt;在现在的小区建设中，开发商往往只会提供一条从弱电井到住户弱电箱的光纤入户线（有时根据广电系的专网要求，还会额外提供一条广电专用的入户线，也是光纤的；半新不老的小区可能有同轴共存），这区区一条光纤，对于我们这些宽带症候群患者来说如鲠在喉，让多少人建家里云的梦想破灭了。&lt;/p&gt;&#xA;&lt;p&gt;这个问题有许多传统的解决方案：最直接的当然是直接再拉一条或者换多芯的光缆，但要是不可行呢？有的尝试走邻居家的线再拉网线过来，有的冒着被偷的风险把光猫和收发器放在弱电井，有的甚至铤而走险私拉飞线（物业：我看到了但我装作没看到）。但这些方法不是太麻烦就是不够优雅，更别提可能带来的安全隐患和物业纠纷。&lt;/p&gt;&#xA;&lt;p&gt;那么，有没有一种既合规又优雅的方式，让我们在只有一根光纤的情况下实现多线接入呢？答案是肯定的——那就是WDM。&lt;/p&gt;&#xA;&lt;h2 id=&#34;技术回顾波分复用技术&#34;&gt;技术回顾：波分复用技术&lt;/h2&gt;&#xA;&lt;p&gt;在深入讲解我的解决方案前，让我们先来了解一下这个听起来就很高大上的“波分复用技术”。&lt;/p&gt;&#xA;&lt;p&gt;波分复用（WDM, Wavelength Division Multiplexing）说白了就是利用光的不同波长可以互不干扰的特性，在同一根光纤中传输多路信号。就像我们在马路上可以有多条车道一样，波分复用技术给光纤“画”出了多条“光的车道”，每个波长就是一条专用车道。&lt;/p&gt;&#xA;&lt;p&gt;在家庭宽带领域，主要使用的PON（无源光网络）技术有几种：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;GPON/EPON：早期技术，下行使用1490nm波长，上行使用1310nm波长&lt;/li&gt;&#xA;&lt;li&gt;XG(S)PON/10G-EPON：下一代接入技术（Next Generation Access），下行使用1577nm波长，上行使用1270nm波长&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;看到这里，聪明的读者们可能已经发现了：这些技术使用的波长不同，这就为我们的复用创造了可能性。&lt;/p&gt;&#xA;&lt;img src=&#34;../assets\wdm-custom-combo-boardband\image-20250419210240760.png&#34; alt=&#34;image-20250419210240760&#34; style=&#34;margin: 0px auto; zoom: 80%;&#34; /&gt;&#xD;&#xA;&lt;p&gt;而实际上，运营商其实早就复用起来了！他们使用的 Combo PON 技术本质上就是波分复用，允许在同一个OLT端口和同一条光纤上同时支持GPON和XG(S)PON业务。我们今天要做的，不过是借用这个原理，先把他们的信号重新拆分，再按我们自己的需求合并起来——可以说是站在巨人的肩膀上搞小发明。&lt;/p&gt;&#xA;&lt;p&gt;那么，有哪些独立的波分复用器符合这个需求呢？一开始，我以为这是一个原理上可行但是小众的需求，因为大部分运营商部署的时候都是直接使用集成了 WDM1r 波分的 Combo PON 板卡。但是经过一番搜索，我找到了完美符合需求的一款设备——华为的WDM1r1201。&lt;/p&gt;&#xA;&lt;img src=&#34;../assets\wdm-custom-combo-boardband\image-20250419210929615.png&#34; alt=&#34;image-20250419210929615&#34; style=&#34;margin: 0 auto;zoom:40%;&#34; /&gt;&#xD;&#xA;&lt;p&gt;更可喜的是，这款设备算相当老的东西，有很多工程余料，所以别被淘宝的价格吓到了，闲鱼最低一张仅需￥38！（顺便一提，它还有一款给1550nm有线电视光链路的姐妹型号WDM1r2202，别买错了）&lt;/p&gt;&#xA;&lt;h3 id=&#34;参数详解&#34;&gt;参数详解&lt;/h3&gt;&#xA;&lt;img src=&#34;../assets\wdm-custom-combo-boardband\image-20250419205743023.png&#34; alt=&#34;image-20250419205743023&#34; style=&#34;margin: 0 auto;zoom:50%;&#34; /&gt;&#xD;&#xA;&lt;p&gt;来看一下&lt;a href=&#34;https://actfornet.com/ueditor/php/upload/file/20201030/1604019658216728.pdf&#34;&gt;Datasheet&lt;/a&gt;里的示意图，WDM1r1201有三个端口：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;GPON：GPON/EPON信号输入&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;NGA（Next Generation Access）：XG(S)PON/对称10G-EPON信号输入&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;COM（Common）：合成信号输出&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;这个小设备的工作原理非常巧妙，让我们再来看一下它的规格参数：&lt;/p&gt;&#xA;&lt;img src=&#34;../assets\wdm-custom-combo-boardband\image-20250419210128568.png&#34; alt=&#34;image-20250419210128568&#34; style=&#34;margin: 0 auto;zoom:67%;&#34; /&gt;&#xD;&#xA;&lt;p&gt;这张图描述的是从COM端口看过去，滤波器对不同波段的处理方式：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;NGA波段(1260-1280 &amp;amp; 1524-1660 nm)是“Pass Band”：当混合信号进入COM端口时，NGA波段的信号会被通过并导向NGA端口。&lt;/li&gt;&#xA;&lt;li&gt;GPON波段(1300-1320 &amp;amp; 1480-1500 nm)是“Reflector Band”：当混合信号进入COM端口时，GPON波段的信号会被反射至GPON端口。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;那么，当两个不同运营商的信号通过这个设备时会不会冲突呢？&lt;/p&gt;&#xA;&lt;p&gt;不会！这就是WDM设备的妙处：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;当ISP1的信号（包含NGA和GPON波长）输入到NGA端口时，只有NGA波长能通过到达COM口，而GPON波长会被阻止。&lt;/li&gt;&#xA;&lt;li&gt;当ISP2的信号（同样包含NGA和GPON波长）输入到GPON端口时，只有GPON波长能通过到达COM口，而NGA波长会被阻止。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;这样，到达COM端口（也就是我们的入户光纤）的就是经过精确筛选的、互不干扰的两种波长信号，就像两列火车在同一条轨道上行驶却永不相撞一样神奇！&lt;/p&gt;&#xA;&lt;h2 id=&#34;方案&#34;&gt;方案&lt;/h2&gt;&#xA;&lt;p&gt;基于上述技术原理，我们就可以设计一个方案，让一根光纤同时接入两个不同运营商的宽带。具体接线方案如下：&lt;/p&gt;&#xA;&lt;p&gt;为了称呼方便，下文将使用 &lt;strong&gt;上行1270nm、下行1577nm波长的 XG(S)PON / 对称10G-EPON 都称为 “NGA”（Next Generation Access）。&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>新柏石KNX协议智能家居网关接入 HomeAssistant</title>
      <link>https://mozz.ie/posts/homeassistant-integration-writeup/</link>
      <pubDate>Sat, 22 Mar 2025 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/homeassistant-integration-writeup/</guid>
      <description>&lt;p&gt;最近搬家，开发商的精装包括一套新柏石（NewBest）的智能家居系统，但是只能用开发商的App接入，这对我来说非常不能忍——控制自己家里的设备还要走一道互联网？所以我搬进来的 Day 1 就开始研究怎么把这些灯和空调之类的接到 HomeAssistant 里。最后前天晚上无意间发现的一个后台命令执行，终于打通了整个环节，让我得以通过自定义集成的方式将他接入内网的 HA。接下来就是整个过程。&lt;/p&gt;&#xA;&lt;p&gt;在开始之前，我也尝试过在网络上搜索方案，不过这套方案似乎是完全 to B 的，网络上资料稀少。搜索开发商名字在抖音上倒是有一些结果，但是他们的方案是非常昂贵、麻烦而且具有侵入性（需要拆机接线）的，需要自己配KNX/IP Gateway。所以我一直想，能不能利用现有的设备直接接入HA。&lt;/p&gt;&#xA;&lt;h2 id=&#34;外围探索&#34;&gt;外围探索&lt;/h2&gt;&#xA;&lt;p&gt;首先观察这套全屋智能的控制设备，分别是客厅的一个主控面板，各个客房的分控面板，以及实体开关。主控面板根据观察是运行的 Android&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322105212479.png&#34; alt=&#34;image-20250322105212479&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;系统设置中，网关连接、设备配置等不少选项都加密了，但是有一个拉起原生Settings的连接WiFi选项。从这里可以连接自己的WiFi，后续还发现这个面板默认5555端口开放，adb shell连上就是 root。但是最核心的这个面板本体APK被360加固了，拆壳过于麻烦，所以我先暂时放下，去观察其他设备。&lt;/p&gt;&#xA;&lt;p&gt;接下来来到弱电箱，其中的核心设备就是题图里的这个“AI Mind”主机。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322110939122.png&#34; alt=&#34;image-20250322110939122&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;根据官网的描述，它通过KNX、RS485等总线协议控制灯、空调等设备，同时还具有丰富的对接和云控功能。在这里，我们主要关注的是他的这个RJ45网口。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20251006123903412.png&#34; alt=&#34;image-20251006123903412&#34;&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;智能主机&#34;&gt;智能主机&lt;/h2&gt;&#xA;&lt;p&gt;在主机最顶部左侧找到RJ45网口，并将其连接到我们的局域网中，通过DHCP Leases分配可以看到他自动获取了IP。我们直接对这个主机进行端口扫描，可以发现开放了22、80等端口。现在打开浏览器访问其80端口，就是这个主机的后台管理系统。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322111744660.png&#34; alt=&#34;image-20250322111744660&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;通过观察 POST /login 这个请求以及一些简单的 F12 操作，我们来到了后台。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322111922414.png&#34; alt=&#34;image-20250322111922414&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;在后台我们可以配置各个区域以及下面的设备、场景、规则等&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322112105912.png&#34; alt=&#34;image-20250322112105912&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;我们已经取得了一些进展，但目前仅仅是这样还不够。因为从前端分析，没有发现给我们任何控制这些设备的接口。接下来，让我们继续深入。&lt;/p&gt;&#xA;&lt;h2 id=&#34;深入底层&#34;&gt;深入底层&lt;/h2&gt;&#xA;&lt;p&gt;在这个面板的参数设置界面，有一个“启动本地KNX调试”的按钮。我们点击一下并观察其请求，让人感到十分甚至九分的亲切，仿佛已经到了家目录一样。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322112542231.png&#34; alt=&#34;image-20250322112542231&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;系统里的curl可以用，也有完整bash。但是最简单的办法就是读一下 &lt;code&gt;/etc/shadow&lt;/code&gt; 然后拿着密码连上 ssh。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/homeassistant-integration-writeup/image-20250322114608443.png&#34; alt=&#34;image-20250322114608443&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;观察 netstat 可以发现这个主机的 Web 服务就是由 &lt;code&gt;SmartHome-Controller-1.0-SNAPSHOT-fat.jar&lt;/code&gt; 提供的，让我们读一下它的代码。&lt;/p&gt;&#xA;&lt;p&gt;搜索相关关键字可以找到，&lt;code&gt;/ntesec/controller/web/handler/v01&lt;/code&gt; 里面的代码就是这些 API 的处理逻辑，对我们有用的主要是这两个方法：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;getRouter().&lt;span style=&#34;color:#a6e22e&#34;&gt;route&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;path&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/getDeviceStatus&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;method&lt;/span&gt;(HttpMethod.&lt;span style=&#34;color:#a6e22e&#34;&gt;GET&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;handler&lt;/span&gt;(CtrlHomeREST::getDeviceStatus);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;getRouter().&lt;span style=&#34;color:#a6e22e&#34;&gt;route&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;path&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/sendKNX&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;method&lt;/span&gt;(HttpMethod.&lt;span style=&#34;color:#a6e22e&#34;&gt;GET&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;handler&lt;/span&gt;(CtrlHomeREST::sendKNX);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sendKNX&lt;/span&gt;(RoutingContext routingContext) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  String realAddr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; routingContext.&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;getParam&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;realAddr&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  String value &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; routingContext.&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;getParam&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  String length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; routingContext.&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;getParam&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;length&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  EventBus eb &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; routingContext.&lt;span style=&#34;color:#a6e22e&#34;&gt;vertx&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;eventBus&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  JsonObject jsonObject &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; JsonObject();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  jsonObject.&lt;span style=&#34;color:#a6e22e&#34;&gt;put&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;realAddr&amp;#34;&lt;/span&gt;, realAddr);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  jsonObject.&lt;span style=&#34;color:#a6e22e&#34;&gt;put&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;, value);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  jsonObject.&lt;span style=&#34;color:#a6e22e&#34;&gt;put&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;length&amp;#34;&lt;/span&gt;, Integer.&lt;span style=&#34;color:#a6e22e&#34;&gt;valueOf&lt;/span&gt;(length));&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  eb.&lt;span style=&#34;color:#a6e22e&#34;&gt;send&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ntesec.controller.executor.writeRealAddrKNX&amp;#34;&lt;/span&gt;, jsonObject);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;getDeviceStatus&lt;/span&gt;(RoutingContext routingContext) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  String deviceIds &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; routingContext.&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;getParam&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deviceIds&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  log.&lt;span style=&#34;color:#a6e22e&#34;&gt;info&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;收到查询设备当前状态请求：deviceIds=》&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; deviceIds);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Vertx vertx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; routingContext.&lt;span style=&#34;color:#a6e22e&#34;&gt;vertx&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  EventBus eb &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; vertx.&lt;span style=&#34;color:#a6e22e&#34;&gt;eventBus&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  VertxFormLoginHandlerImpl.&lt;span style=&#34;color:#a6e22e&#34;&gt;isOnline&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (StringUtil.&lt;span style=&#34;color:#a6e22e&#34;&gt;isNullOrEmpty&lt;/span&gt;(deviceIds)) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    log.&lt;span style=&#34;color:#a6e22e&#34;&gt;info&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;返回当前所有设备状态&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; GlobalData.&lt;span style=&#34;color:#a6e22e&#34;&gt;statusMap&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    RespUtil.&lt;span style=&#34;color:#a6e22e&#34;&gt;writeJsonLmx&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;, GlobalData.&lt;span style=&#34;color:#a6e22e&#34;&gt;statusMap&lt;/span&gt;, routingContext);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    String&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; ids &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; deviceIds.&lt;span style=&#34;color:#a6e22e&#34;&gt;split&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Integer, JsonObject&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; tmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; HashMap&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;gt;&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (String id : ids) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      tmp.&lt;span style=&#34;color:#a6e22e&#34;&gt;put&lt;/span&gt;(Integer.&lt;span style=&#34;color:#a6e22e&#34;&gt;valueOf&lt;/span&gt;(id), (JsonObject)GlobalData.&lt;span style=&#34;color:#a6e22e&#34;&gt;statusMap&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;get&lt;/span&gt;(Integer.&lt;span style=&#34;color:#a6e22e&#34;&gt;valueOf&lt;/span&gt;(id)));&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    log.&lt;span style=&#34;color:#a6e22e&#34;&gt;info&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;返回查询设备状态&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; tmp);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    RespUtil.&lt;span style=&#34;color:#a6e22e&#34;&gt;writeJsonLmx&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;, tmp, routingContext);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;有了这些方法，就可以写入KNX总线信息和读取状态，足以实现一个 HomeAssistant Custom Component 了。&lt;/p&gt;</description>
    </item>
    <item>
      <title>双方无公网状态下 RouterOS 基于 WireGuard 的组网方案</title>
      <link>https://mozz.ie/posts/dual-cgnat-routeros-wireguard-tunnel/</link>
      <pubDate>Fri, 24 Jan 2025 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/dual-cgnat-routeros-wireguard-tunnel/</guid>
      <description>&lt;p&gt;目前各大运营商都在收紧 IPv4 公网分配，而 IPv6 却并不是随处可见（如校园、公司等场景）。在大部分场景下，获得 Full Cone NAT （下称 NAT1）的机会反而相对较多。&lt;/p&gt;&#xA;&lt;p&gt;我们都知道 WireGuard 是一个基于 UDP 协议的隧道协议，通过 STUN 客户端简单地打个洞就可以在单方 NAT1 的情况下建立隧道，此类教程在 Linux 上已比比皆是，但 RouterOS 有没有 STUN Client 呢？&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;某人：没有 但是他有docker（&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;好的，一语惊醒梦中人，这个没毛病。不过其实在打洞这个场景下，无论是 RouterOS 的容器，还是同子网的另一个 Linux 机器，地位是相同的。&lt;/p&gt;&#xA;&lt;p&gt;那么现在摆在我们面前的还有两个问题：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;怎么确保代打完洞之后，这个端口的数据包发给 RouterOS 上的 WG Server 而不是流向打洞的客户端？&lt;/li&gt;&#xA;&lt;li&gt;IP 和端口变化了的话，另外一个 peer 怎么获取新的 Endpoint？&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;省流：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;/ip/firewall/nat/add action=redirect chain=dstnat dst-port=13231 protocol=udp to-ports=13231&lt;/code&gt; 把流量截留住&lt;/li&gt;&#xA;&lt;li&gt;用 NATMap 的 IP4P 格式把 IP 和端口写到 AAAA 记录里，然后写一个 RouterOS Script 解析并更新。&lt;/li&gt;&#xA;&lt;li&gt;如果两端都是 Full Cone NAT，你甚至不需要担心这个问题，因为当单端 IP 变更的时候，WireGuard 会继续尝试连接另外一端，而另外一端只要握手成功，就会自动把 Current Endpoint 更新过来。只要不是两边同时掉线，你不需要重新打洞，也不需要更换 IP。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;如果你懂得相关知识，想要自己实现，那么看到这就OK了。&lt;/p&gt;</description>
    </item>
    <item>
      <title>广东联通 IPTV 鉴权&amp;抓源脚本（以及碎碎念）</title>
      <link>https://mozz.ie/posts/gdcu-iptv-playlist/</link>
      <pubDate>Sun, 27 Oct 2024 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/gdcu-iptv-playlist/</guid>
      <description>&lt;blockquote&gt;&#xA;&lt;p&gt;好久不见，大家最近的网上冲浪生活过得如何？本来有很多次都想写博客，但是每当我准备动笔的时候我都不禁有，我即将要写的这个话题对读者有用吗？他们会喜欢看我的碎碎念吗？这么流水账的东西，还是不要写了吧……等种种念头，最终又导致我偷懒。那么总算是有一些可能对大家有用的东西，借着这个由头，我写下了这篇文章。&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;首先讲一下目前家里网络的配置吧。在下述事件发生的时间点，我家里有5个运营商的入户线，并且办理了5个宽带帐户，分别是：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;广东电信（169元普通融合套餐 1000/100 公网+IPTV、290元CN2游戏宽带 无公网）&lt;/li&gt;&#xA;&lt;li&gt;广东联通（180元商务极光1000/300 公网、38元三折冰淇淋 500/50 无公网）&lt;/li&gt;&#xA;&lt;li&gt;广东移动（79元芒果卡 500/50 无公网）&lt;/li&gt;&#xA;&lt;li&gt;广东广电（有入户线未安装）&lt;/li&gt;&#xA;&lt;li&gt;长城宽带（有入户线未安装）&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;广东电信最近在疯狂的以打击PCDN之名关停大流量宽带的公网IP，并且将这些用户都拉到深圳出口，NAT类型为Symmetric。坊间称为广东电信NAT4竞技场事件。意料之中的是，我也被牵连了——因为我确实有跑PCDN，具体的表现是：MTU 变成 1430，IPv4 分到 100.64 的 CGNAT IP，IPv6 不能入站+半小时变一次。具体的事件可以看&lt;a href=&#34;https://www.v2ex.com/t/1079783&#34;&gt;这个&lt;/a&gt;和&lt;a href=&#34;https://www.v2ex.com/t/1082313#reply110&#34;&gt;这个&lt;/a&gt;帖子，在文章里就不展开讲了。与选择硬刚电信到底的网友不同，我对我家这条 169/月 1000/100 带公网的电信的态度一直是能让我跑我就跑，给我掐了我也愿赌服输。所以我麻利地带上光猫去营业厅办理了销户，然后转头就到隔壁的联通营业厅加开了IPTV业务。为什么是联通？因为电信和移动单独加IPTV都要20元一个月，而联通只要10元一个月，我也不知道为什么他们那么贵。&lt;/p&gt;&#xA;&lt;p&gt;师傅非常敬业地快速来安装了，盒子型号是数码视讯TR100。由于广东联通一直以来的摆烂态度，IPTV这种业务他们肯定是完全不上心的（不然也不会必须到营业厅办理），所以机顶盒中一个广告也没有，甚至连电信/移动标配的增值业务包也没有，非常干净。而相对的，就是节目源的缺乏——我扫了一眼频道列表，就发现了没有本地台、高清卫视台只有7个、各种频道的回看缺失（在后面把源提取出来之后，竟然实际上能看）等种种问题。当然这些问题也无伤大雅，反正真正看的就那么几个台。&lt;/p&gt;&#xA;&lt;p&gt;抓源的过程非常简单，我也做了一个小脚本方便进行鉴权和频道整理，以下是流程：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;按照&lt;a href=&#34;https://mozz.ie/posts/extracting-iptv-live-streams/&#34;&gt;前文的方法&lt;/a&gt;抓取完整过程的包，然后这次搜索 分组字节流-字符串 输入 &lt;code&gt;grant_type=EncryToken&lt;/code&gt;&#xA;&lt;img src=&#34;../assets/gdcu-iptv-playlist/image-20241030215024704.png&#34; alt=&#34;image-20241030215024704&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;在数据包详情里面滚动到最下面，有一个Full request URI，右键 复制-值，就可以获得完整的鉴权 URL&#xA;&lt;img src=&#34;../assets/gdcu-iptv-playlist/image-20241030215209212.png&#34; alt=&#34;image-20241030215209212&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;替换以下脚本中的鉴权URL，并把脚本保存为 iptv.py&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; requests&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; json&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; os&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; sys&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 设置工作目录为脚本所在目录&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;os&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;chdir(os&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;dirname(os&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;path&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;abspath(__file__)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;s &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; requests&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Session()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;s&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;headers[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;User-Agent&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;okhttp/3.10.0&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 获取所有频道信息&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;all_channels_response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; s&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://120.87.12.38:8083/epg/api/custom/getAllChannel.json&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;all_channels_data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; all_channels_response&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;json()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; all_channels_data[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;status&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;200&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;channels&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; all_channels_data:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;错误：无法获取频道列表或频道列表格式错误。&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sys&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exit(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 提取频道代码&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;channel_codes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [channel[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;params&amp;#39;&lt;/span&gt;][&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hwcode&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; channel &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; all_channels_data[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;channels&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;params&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channel &lt;span style=&#34;color:#f92672&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hwcode&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channel[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;params&amp;#39;&lt;/span&gt;]]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;channel_codes_str &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;join(channel_codes)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 获取访问令牌&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;token_response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; s&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;这里替换鉴权URL，可能IP地址不同，请确保同时修改下面的IP&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;access_token &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; token_response&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;json()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;access_token&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; access_token:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;错误：未能获取有效的 access token。&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sys&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exit(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 使用访问令牌请求数据&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;headers &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Authorization&amp;#39;&lt;/span&gt;: access_token,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;User-Agent&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;okhttp/3.10.0&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Connection&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Keep-Alive&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;application/json;charset=utf-8&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; json&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;dumps({&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;channelcodes&amp;#34;&lt;/span&gt;: channel_codes_str})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 请修改此处IP，确保与鉴权URL的IP一致&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; s&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;post(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://120.87.11.25:33200/EPG/interEpg/channellist/batch&amp;#34;&lt;/span&gt;, headers&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;headers, data&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;data)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; response&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;json():&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;错误：返回的数据为空。&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sys&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exit(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 保存响应数据到文件&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;with&lt;/span&gt; open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;iptv.json&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;w&amp;#39;&lt;/span&gt;,encoding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    json&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;dump(response&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;json(), f)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 复制 base.txt 到 iptv.txt&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;with&lt;/span&gt; open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;base.txt&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;r&amp;#39;&lt;/span&gt;,encoding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f_base, open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;iptv.txt&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;w&amp;#39;&lt;/span&gt; ,encoding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f_iptv:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    f_iptv&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;write(f_base&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 读取 iptv.json 并处理数据&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;with&lt;/span&gt; open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;iptv.json&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;r&amp;#39;&lt;/span&gt;,encoding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; json&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;load(f)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; data&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;channellist&amp;#39;&lt;/span&gt;):&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;错误：&amp;#39;channellist&amp;#39; 数据为空。&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sys&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exit(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    channels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; item &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; data[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;channellist&amp;#39;&lt;/span&gt;]:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        hwcode &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;channelcode&amp;#39;&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        channel_info &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; next((ch &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ch &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; all_channels_data[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;channels&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ch[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;params&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hwcode&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; hwcode), &lt;span style=&#34;color:#66d9ef&#34;&gt;None&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; channel_info:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        channel_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; channel_info[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;title&amp;#39;&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        timeshift_url &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;timeshifturl&amp;#39;&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;其它&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CCTV&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channel_name &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CGTN&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channel_name:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;央视&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;elif&lt;/span&gt; any(x &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channel_name &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;广东&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;广州&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;大湾区&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;南方&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;岭南&amp;#34;&lt;/span&gt;]):&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;广东&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;elif&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;卫视&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channel_name:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            group &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;卫视&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; group:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; group &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channels:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                channels[group] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            channels[group]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;channel_name&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;timeshift_url&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 写入处理后的数据到 iptv.txt&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;with&lt;/span&gt; open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;iptv.txt&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;,encoding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; group, ch_list &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; channels&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;items():&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            f&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;write(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;group&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;,#genre#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; channel &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; ch_list:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                f&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;write(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;channel&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;在同目录新建一个 base.txt，放你需要的其他频道列表（比如我放了一些其他节目源），如果没有就新建一个 base.txt 然后里面什么都不写即可。&lt;/p&gt;</description>
    </item>
    <item>
      <title>广东电信 IPTV 自助鉴权 &#43; 获取播放列表</title>
      <link>https://mozz.ie/posts/gdct-iptv-auth-and-fetch-playlist/</link>
      <pubDate>Sun, 25 Jun 2023 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/gdct-iptv-auth-and-fetch-playlist/</guid>
      <description>&lt;p&gt;前些日子发现广东电信把抓包获取的 RTSP 地址有效期改成 30 天了，导致每次失效都要去重新抓包。研究发现可以重放鉴权包，现在可以在电脑完成整个过程了。此教程适用于使用 183.59 网段上平台进行登录和获取播放列表的广东电信 IPTV 用户。&lt;/p&gt;&#xA;&lt;h2 id=&#34;操作方法&#34;&gt;操作方法&lt;/h2&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;按照&lt;a href=&#34;https://mozz.ie/posts/extracting-iptv-live-streams/&#34;&gt;前文&lt;/a&gt;的方法抓取完整过程的包&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;找到 &lt;code&gt;/EPG/jsp/ValidAuthenticationHWCTC.jsp&lt;/code&gt; 这个请求&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/gdct-iptv-auth-and-fetch-playlist/image-20230625095438978.png&#34; alt=&#34;image-20230625095438978&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;在 &amp;ldquo;HTML Form URL Encoded&amp;rdquo; 上单击右键选择 复制 - As Printable Text，你会获得类似下面这样的东西：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;UserID=02012345678&amp;amp;Lang=&amp;amp;SupportHD=1&amp;amp;NetUserID=02012345678%40iptv.gd&amp;amp;DHCPUserID=02012345678%40iptv.gd&amp;amp;Authenticator=[HEX DUMP]&amp;amp;STBType=...&amp;amp;STBVersion=...&amp;amp;conntype=2&amp;amp;STBID=...&amp;amp;templateName=iptvsnmv3&amp;amp;areaId=&amp;amp;userToken=...&amp;amp;userGroupId=...&amp;amp;productPackageId=&amp;amp;mac=...&amp;amp;UserField=&amp;amp;SoftwareVersion=&amp;amp;IsSmartStb=0&amp;amp;desktopId=1&amp;amp;stbmaker=&amp;amp;VIP=&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;把以下命令补充完整（上面抓到的 Destination IP 每个市都不一样）&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;curl http://[上面抓到的 Destination IP]:8082/EPG/jsp/ValidAuthenticationHWCTC.jsp -c cookie.txt -H &amp;#39;Content-Type: application/x-www-form-urlencoded&amp;#39; --data &amp;#39;这里填上面获得的参数&amp;#39;&#xD;&#xA;curl http://[上面抓到的 Destination IP]:8082/EPG/jsp/getchannellistHWCTC.jsp -b cookie.txt -o res.html&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;在一台可以访问 183.59 网段的电脑上运行以上命令（只需将 183.59.0.0/16 分流到 @iptv.gd 那个拨号连接上即可）&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;你会获得一个 res.html，按照 &lt;a href=&#34;https://mozz.ie/posts/extracting-iptv-live-streams/&#34;&gt;前文&lt;/a&gt; 的方法导出播放列表即可。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;</description>
    </item>
    <item>
      <title>为什么我们要拒绝 PON 方案的 FTTR</title>
      <link>https://mozz.ie/posts/why-not-pon-fttr/</link>
      <pubDate>Sun, 07 May 2023 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/why-not-pon-fttr/</guid>
      <description>&lt;h2 id=&#34;背景&#34;&gt;背景&lt;/h2&gt;&#xA;&lt;p&gt;最近许多运营商都开始强推自己基于 PON 架构的 FTTR 方案，其实现就是入户光猫在接入运营商网络的同时，作为一个OLT，下联子光猫（ONU）提供光纤到房间的接入方案。运营商声称这是实现他们“三千兆”、“五千兆”等营销目标的最佳手段，但实际上这种方案与 PON 技术要解决的问题完全地背道而驰，不仅无法体现 PON 技术的优势，更为用户当前的使用与未来的升级设下障碍、徒增成本。&lt;/p&gt;&#xA;&lt;h2 id=&#34;技术回顾&#34;&gt;技术回顾&lt;/h2&gt;&#xA;&lt;h3 id=&#34;无源光网络pon&#34;&gt;无源光网络（PON）&lt;/h3&gt;&#xA;&lt;p&gt;无源光网络（PON）的发展经历了从APON（ATM passive optical network）到GPON/EPON，再到XGPON/10G EPON的几个阶段。早期的无源光网络标准APON由ITU提出，采用ATM传输模式进行通信，并在随后升级为BPON并加入许多管理机制，其支持千兆速度的标准就被称为GPON（gigabit-capable passive optical network）。与此同时IEEE也提出了自己的PON标准，被称为EPON（Ethernet Passive Optical Network）。&#xA;从这些名字的变化来看，不难看出两个组织之间各自所背负的传统（ATM vs Ethernet 之争）对PON技术的深刻影响。但不管这两种标准之间的差异如何，无源光网络共享着一个最显著的特征：无源（即 Passive，其实“无源”这个翻译十分容易让人误解，我觉得倒不如直翻为“被动”更直观一些）。其原理为利用时分复用（TDM）技术，使从同一线路上可以同时承载许多用户（ONU）。这些用户&lt;strong&gt;在OLT的管理&lt;/strong&gt;下，仅在给定的时隙进行数据传输（发光），从而避免干扰和冲突。也正是这样，我们可以通过光分路器把光平均分配给多个用户。光分路器是纯物理结构，可以在各种恶劣环境下进行部署，非常适合运营商用于建设接入网。&lt;/p&gt;&#xA;&lt;h3 id=&#34;以太网ethernet&#34;&gt;以太网（Ethernet）&lt;/h3&gt;&#xA;&lt;p&gt;而与 Passive 被动相对的则是Active（有源）的以太网，它是我们非常熟悉的网络技术，它由一系列IEEE的802.3标准所定义，常见于所有用户侧设备。本来它并不是与 PON 直接进行竞争的技术（正如上文所提到的那样，Ethernet over PON是十分常见的架构，实际上GPON和EPON都有在使用它），但当运营商把PON技术下放到家庭组网时，我们便不得不将他们放在一起进行对比。以太网的 Active 特点表现在如果我们需要将他分配给多个用户，则必须使用交换机，把以太网帧在不同的线路中进行交换，这使得它非常不便于在户外等复杂条件下进行部署。&lt;/p&gt;&#xA;&lt;h2 id=&#34;分析&#34;&gt;分析&lt;/h2&gt;&#xA;&lt;p&gt;前面已经提到了无源光网络的优势及原理，以及以太网的有源特点，相信认真读完的朋友应该已经理解我所说“在家庭网络环境中无法体现 PON 技术的优势”的缘由了。道理非常简单，家庭网络是一个可控的、简单的、小规模的环境，布线距离短，房间数量少。大多数家庭的布线情况根本不需要用到分光器，全部房间都有直通一点的线；即使需要中继，部署有源的交换机成本也极低（因为不需要考虑户外等条件）。这直接消灭了无源光网络的优势。此为拒绝PON FTTR方案的第一个理由。&lt;/p&gt;&#xA;&lt;p&gt;其次，PON网络架构的特点阻碍用户当前的使用。PON下的各ONU没有相互沟通的能力，所有数据必须经由OLT转发。这样一来，家庭网络中的瓶颈竟然可笑地变为了运营商部署的光猫（CPE）。光猫的转发能力在这里不仅局限了你的互联网接入速度，甚至还局限了你家庭内网的速度。以最常见的8145XR+K662c设备为例，其下行光口为GPON协议，受限于此，内网间的互联速度根本达不到万兆，仅有2000Mbps左右。此为拒绝PON FTTR方案的第二个理由。&lt;/p&gt;&#xA;&lt;p&gt;最后，也是最大的问题。PON FTTR并不是一个完全开放的标准，各家设备商的实现是相当封闭的，不存在互操作性[2]。在以太网方案下，用户可以自由选择光/电模块、交换机以及路由器，想要整体升级还是只升级某段链路都由用户自己把握；而FTTR则是完全的黑盒，所有设备均由一个厂家生产，除非替换全部设备，自由升级的空间非常小。此为拒绝PON FTTR方案的最大理由。&lt;/p&gt;&#xA;&lt;h2 id=&#34;结论&#34;&gt;结论&lt;/h2&gt;&#xA;&lt;p&gt;我不推荐任何人使用运营商的PON FTTR方案，除非完全免费（这样你可以无偿获得光纤布线服务，并自己切换到以太网光纤方案）。让我们借用 &lt;a href=&#34;https://www.v2ex.com/member/icy37785&#34;&gt;@icy37785&lt;/a&gt; 的&lt;a href=&#34;https://www.v2ex.com/t/932975&#34;&gt;一句话&lt;/a&gt;作结吧：“FTTR 是一套很神奇的几乎没有任何优点的方案。很少见到这样全是缺点几乎没优点的方案”。&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;&lt;strong&gt;参考&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;[1] &lt;a href=&#34;https://www.fiber-optical-networking.com/tag/apon&#34;&gt;https://www.fiber-optical-networking.com/tag/apon&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;[2] &lt;a href=&#34;https://www.txrjy.com/thread-1186133-1-1.html&#34;&gt;https://www.txrjy.com/thread-1186133-1-1.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;[3] &lt;a href=&#34;https://www.e1-converter.com/TechnicalLectures/What-is-APON-BPON-EPON-GPON.html&#34;&gt;https://www.e1-converter.com/TechnicalLectures/What-is-APON-BPON-EPON-GPON.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;[4] &lt;a href=&#34;https://en.wikipedia.org/wiki/Ethernet&#34;&gt;https://en.wikipedia.org/wiki/Ethernet&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;[5] &lt;a href=&#34;https://en.wikipedia.org/wiki/Passive_optical_network&#34;&gt;https://en.wikipedia.org/wiki/Passive_optical_network&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;[6] &lt;a href=&#34;https://zhuanlan.zhihu.com/p/490288451&#34;&gt;https://zhuanlan.zhihu.com/p/490288451&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;[7] &lt;a href=&#34;https://zhuanlan.zhihu.com/p/415854426&#34;&gt;https://zhuanlan.zhihu.com/p/415854426&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>把 Windows 11/10 不完全转换为 Windows Server 2022</title>
      <link>https://mozz.ie/posts/turn-windows-11-into-server-2022/</link>
      <pubDate>Mon, 02 Jan 2023 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/turn-windows-11-into-server-2022/</guid>
      <description>&lt;p&gt;大家都知道 Windows 的功能其实很强大，但你并不总能够在同一个 Windows SKU 上享用所有功能。这一点在 Hyper-V 方面尤其明显。常见的 Windows 10 和 11 专业版尽管支持部分 Hyper-V 功能，但是要想享受完整的功能，则必须使用 Server 版本。&lt;/p&gt;&#xA;&lt;p&gt;前几天，我计划跟随 &lt;a href=&#34;https://devblogs.microsoft.com/scripting/passing-through-devices-to-hyper-v-vms-by-using-discrete-device-assignment/&#34;&gt;这篇教程&lt;/a&gt;，来把我的无线网卡透传进 Hyper-V 虚拟机并且运行 OpenWRT 软 AP。但不出意料的是，它所依赖的 PCIe 设备直通功能（Discrete Device Assignment）需要 Windows Server 系统才能正常使用。否则当你进行完 &lt;code&gt;Add-VMAssignableDevice&lt;/code&gt; 之后，尝试启动虚拟机时，会得到以下提示：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/turn-windows-11-into-server-2022/image-20230102115630587.png&#34; alt=&#34;image-20230102115630587&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;但是，我并不想花费大力气把用得好好的系统抹掉然后重新安装 Server 版本。考虑到这里的启动限制应该只是检查一下 SKU，我们并不需要真正的完整 Server 功能，那么有没有一种办法能无损把系统记录的 SKU 从 Windows 11 Enterprise 变成 Windows Server 2022 呢？答案是有的。我在 &lt;a href=&#34;https://www.reddit.com/r/HyperV/comments/rd1pf5/some_ponderings_on_dda_on_windows_1011_pro/&#34;&gt;reddit&lt;/a&gt; 找到了一个方案，具体操作步骤如下：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;取得一个 Windows Server 2022 的 ISO，解压其中的 install.wim&lt;/li&gt;&#xA;&lt;li&gt;把 wim 镜像里面 Datacenter 版本的 &lt;code&gt;Windows\Branding&lt;/code&gt; 和 &lt;code&gt;Windows\System32\spp\tokens\skus&lt;/code&gt; 两个文件夹提取出来（用7z即可）&lt;/li&gt;&#xA;&lt;li&gt;把当前系统的这两个文件夹剪切出来，备份&lt;/li&gt;&#xA;&lt;li&gt;把提取出的文件夹替换到当前系统的对应位置&lt;/li&gt;&#xA;&lt;li&gt;使用管理员权限执行 &lt;code&gt;slmgr.vbs /rilc&lt;/code&gt; 重新安装许可证文件。&lt;/li&gt;&#xA;&lt;li&gt;使用 &lt;code&gt;slmgr.vbs /ipk 密钥&lt;/code&gt; 来安装密钥。如果你使用 KMS，则可以在&lt;a href=&#34;https://learn.microsoft.com/zh-cn/windows-server/get-started/kms-client-activation-keys&#34;&gt;微软官方页面&lt;/a&gt;找到对应的密钥。&lt;/li&gt;&#xA;&lt;li&gt;自行想办法激活 Windows&lt;/li&gt;&#xA;&lt;li&gt;等待一会，重启一下。&lt;/li&gt;&#xA;&lt;li&gt;然后再等待一会，重启第二次。这次重启应该会提示「正在配置功能」或者「正在安装更新」之类的。&lt;/li&gt;&#xA;&lt;li&gt;第二次重启完进入系统，应该就能够使用 Server 的功能了，同时原来属于 Windows 10/11 的功能则会被隐藏（如 Windows 11 输入法、移动热点、Windows Hello等）&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;通过以上方式，我成功地启动了使用 DDA 功能的虚拟机，并使用透传其中的 AX200 开启热点。&lt;/p&gt;</description>
    </item>
    <item>
      <title>高通410随身WiFi的进阶USB网络共享和IPv6配置</title>
      <link>https://mozz.ie/posts/usb-ecm-and-ipv6-for-openstick/</link>
      <pubDate>Wed, 05 Oct 2022 23:29:11 +0800</pubDate>
      <guid>https://mozz.ie/posts/usb-ecm-and-ipv6-for-openstick/</guid>
      <description>&lt;p&gt;大概是今年年初开始，酷安社区那边掀起了折腾淘宝上那些高通410平台的随身WiFi的热潮，它们价格低廉、解锁简易、拓展性强的特点使得各路大神都投入了极大的热情来开发其周边玩法，&lt;a href=&#34;https://www.kancloud.cn/handsomehacker/openstick/2636505&#34;&gt;OpenStick&lt;/a&gt;就是一个能让这个随身WiFi跑debian的项目。这个棒子的相关信息网上已经有非常非常多了，我在这里就不陈词滥调介绍，而是速战速决分享一些新的玩法和优化。&lt;/p&gt;&#xA;&lt;h2 id=&#34;修改-gadget-让其支持-usb-cdc-ecm&#34;&gt;修改 Gadget 让其支持 USB CDC-ECM&lt;/h2&gt;&#xA;&lt;p&gt;首先是我想把这个棒子直接插在 CCR1036 上让他作为带外管理使用，但是显然它没有直接就能用，所以我稍微研究了一下，主要涉及添加 ECM 功能和修改 Vendor ID/Device ID两部分。&lt;/p&gt;&#xA;&lt;h3 id=&#34;什么是-usb-gadget&#34;&gt;什么是 USB Gadget&lt;/h3&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/zjujoe/article/details/2645510&#34;&gt;https://blog.csdn.net/zjujoe/article/details/2645510&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;Linux-USB Gadget&lt;/em&gt; 驱动框架（以下简称 &lt;em&gt;Gadget&lt;/em&gt;）实现了&lt;em&gt;USB&lt;/em&gt; 协议定义的设备端的软件功能。基于 &lt;em&gt;API, Gadget&lt;/em&gt; 驱动实现了一套硬件无关的功能，这基本上可以对应到 &lt;em&gt;USB&lt;/em&gt; 协议里 的各种 &lt;em&gt;USB Class&lt;/em&gt;。&lt;/p&gt;&#xA;&lt;p&gt;普通的 &lt;em&gt;Gadget&lt;/em&gt; 驱动只实现一个功能（比如， &lt;em&gt;u&lt;/em&gt; 盘，&lt;em&gt;usb&lt;/em&gt; 网卡）。复合设备可以支持多个功能。像智能手机*, PDA*这样的设备，硬件支持较丰富的端点、&lt;em&gt;DMA Buffer,&lt;/em&gt; 给软件提了支持复合功能的基础。&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;简单的说就是在一个USB接口上实现多个功能的框架。&lt;/p&gt;&#xA;&lt;h3 id=&#34;什么是-usb-cdc-ecm&#34;&gt;什么是 USB CDC-ECM&lt;/h3&gt;&#xA;&lt;p&gt;CDC-ECM 是一套和微软 RNDIS 类似的，实现 Ethernet over USB 的协议，但它是由 USB-IF 制定的业界标准，除了 Windows 之外其他系统（Linux、macOS）基本都支持。&lt;/p&gt;&#xA;&lt;h3 id=&#34;handsomemodopenstick-项目的发行版-如何管理和使用-gadget&#34;&gt;HandsomeMod（OpenStick 项目的发行版） 如何管理和使用 Gadget&lt;/h3&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.kancloud.cn/handsomehacker/openstick/2637561&#34;&gt;https://www.kancloud.cn/handsomehacker/openstick/2637561&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;OpenStick 提供的所有系统都使用基于libusbgx的Gadget Controller (以下简称gc)来管理usb在device模式下的行为。&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;该发行版使用 &lt;a href=&#34;https://github.com/HandsomeMod/gc&#34;&gt;gc&lt;/a&gt; 来管理 Gadget，而且作者在编写这个程序的时候就支持了许多种设备类型，包括CDC-ECM。我们只需要修改系统开机启动会调用的脚本 &lt;code&gt;/usr/sbin/mobian-usb-gadget&lt;/code&gt; 就可以，修改后的脚本如下。&lt;/p&gt;</description>
    </item>
    <item>
      <title>ThinkBook 14&#43; 锐龙版上手体验</title>
      <link>https://mozz.ie/posts/thinkbook-14-g4&#43;ara-amd-ryzen-hands-on/</link>
      <pubDate>Mon, 01 Aug 2022 19:38:11 +0000</pubDate>
      <guid>https://mozz.ie/posts/thinkbook-14-g4&#43;ara-amd-ryzen-hands-on/</guid>
      <description>&lt;p&gt;2022年，史称6800H(S)年。乘着 Ryzen 6000 系在移动端能耗比傲视群雄的东风，各个厂商在5500~6500价位展开了激烈的竞争。荣耀有 MagicBook 14，华硕有天选3，小米有 RedmiBook Pro 14/15，惠普有战99和光影精灵8，机械革命有 Code01，连败家之眼都要掺一脚出了个幻14（这货卖一万一）。但是要说哪家斗得最惨最激烈，还得数联想自己。联想在这个价位足足出了四台6800H(S)本子：小新 Air14 Plus、小新  Pro16、ThinkPad neo 14 和我今天才拿到手的 ThinkBook 14+。&lt;/p&gt;&#xA;&lt;h2 id=&#34;购买&#34;&gt;购买&lt;/h2&gt;&#xA;&lt;p&gt;这个本子的购买并不容易。它的首发价是 5299，虽然我不清楚首发有多少货，但是它一定非常好卖，因为京东卖完首发之后直接加价到 5499 了，依然被持续抢空；最离谱的是连 5999 的钓鱼价好像都有人买。不过倒是有不少在闲鱼串货的经销商以5399的价格买。我本来也心动了，然而思来想去，觉得要是出了问题闲鱼可没有七天无理由，于是还是另寻他路。&lt;/p&gt;&#xA;&lt;p&gt;幸运的是，在闲鱼商品的评论区，我看到有人指路抖音官方旗舰店：5499叠加一张减100券和新客减6券，最后到手5393。而京东和官网这个时候还挂着5499元无货中……&lt;/p&gt;&#xA;&lt;p&gt;抖音虽然写着是预售但是发货特别快，下单第三天就给我从上海发货了。于是，到今天我拿到手就第一时间进行了全方位的测试。&lt;/p&gt;&#xA;&lt;h2 id=&#34;配置&#34;&gt;配置&lt;/h2&gt;&#xA;&lt;p&gt;在开始讲我的体验之前，还是先过一遍这个本子的配置如下图。接口有两个 Type-A 的 USB 3.2 Gen1、两个 Type-C 的 USB 4.0（BIOS升级）、一个隐藏  Type-A USB 2.0 插鼠标用、HDMI 2.1、Micro SD、折叠式RJ45和耳机孔。接口算是比较丰富，而且 RJ45 的存在让他一下子就高于平均水准了，这也是吸引我的很大一个原因。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/ThinkBook-14-G4+ARA-AMD-Ryzen-Hands-On/image-20220802034028133.png&#34; alt=&#34;image-20220802034028133&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;这款机器除了 IR 摄像头，还预留了指纹电源键的位置（没有装指纹款），可以自己买一个指纹电源组件换上去。&lt;/p&gt;&#xA;&lt;h2 id=&#34;测试&#34;&gt;测试&lt;/h2&gt;&#xA;&lt;p&gt;今天花了一个下午和群友测试各种配置以及 Throttle 方案，并且最后粗略做了一个测试。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../assets/ThinkBook-14-G4+ARA-AMD-Ryzen-Hands-On/image-20220802034855557.png&#34; alt=&#34;image-20220802034855557&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;设置 75% 亮度 + RyzenAdj Throttle 到 6~11w + EnergyStar 压制后台 ，测试的同时打开 WiFi、Telegram、Synology Drive Client 在后台。最后 PCMark 8 工作续航测试 6h33min。&lt;/p&gt;</description>
    </item>
    <item>
      <title>ArchLinux &#43; KDE 一周使用小结</title>
      <link>https://mozz.ie/posts/experience-summary-for-arch-and-kde/</link>
      <pubDate>Mon, 27 Jun 2022 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/experience-summary-for-arch-and-kde/</guid>
      <description>&lt;p&gt;终于考完了，又来到一个学期末的长草期。没事可干的我在把家里卧室也升级到万兆之后，便蠢蠢欲动想找一个新的什么东西来折腾。&lt;/p&gt;&#xA;&lt;p&gt;刚好同样也是在半年前，大二上的期末，我安装了基于 GNOME 桌面环境的 Ubuntu 21 进行了「Linux 30天挑战」——我似乎忘了向大家报告这个挑战最后的结果：很遗憾，在坚持了大半个月之后失败了。&lt;/p&gt;&#xA;&lt;p&gt;而究其失败的根本原因是GNOME的分数缩放有一系列的 BUG，包括但不限于 flameshot 黑屏/崩溃/选取不全、electron 应用全屏会黑屏（Jellyfin Media Player）、部分 QT 应用缩放失效（WPS、网易云音乐）以及 UI 错位等（欧路词典）&lt;/p&gt;&#xA;&lt;p&gt;这一系列小毛病让我的桌面体验虽然能用，但是极度不爽；更别说一更新就爆炸的 CSGO 了……总之，我没有找到解决这些问题的好办法，最后还是回归了 Windows。&lt;/p&gt;&#xA;&lt;p&gt;但是这只是一时的妥协，而我依然希望继续使用 Linux 桌面。所以我想，KDE 会不会是一个新的出路？抱着这个念头，我下载了 ArchLinux ISO。因为在我看来，中文生态最好的两个发行版就是 Ubuntu 和 Arch 了；而我这种懒癌晚期是极度讨厌手动打包或者安装应用的。所以第二次 Linux 挑战，在 Arch 上堂堂开幕！&lt;/p&gt;&#xA;&lt;h2 id=&#34;安装--基本配置&#34;&gt;安装 &amp;amp; 基本配置&lt;/h2&gt;&#xA;&lt;p&gt;安装方面，没什么好说的，就是跟着 Wiki 的指引下载并且配置自己需要的软件包就好了，我也不是第一次装 Arch 了。&lt;/p&gt;&#xA;&lt;h3 id=&#34;refind引导配置&#34;&gt;rEFInd引导配置&lt;/h3&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 只自动搜索外置设备和光驱的 EFI 项目&#xA;scanfor external,optical,manual&#xA;&#xA;# 手动配置 Windows 和 Linux 的 entry&#xA;menuentry &amp;#34;Arch Linux&amp;#34; { &#xA;  icon /EFI/refind/themes/rEFInd-minimal/icons/os_arch.png&#xA;  volume  &amp;#34;Arch Linux&amp;#34; &#xA;  loader  /boot/vmlinuz-linux &#xA;  initrd  /boot/initramfs-linux.img &#xA;  options &amp;#34;root=PARTUUID=c2ae9da6-29ce-c24b-bbbb-b3e33340c681 rw add_efi_memmap&amp;#34; &#xA;  submenuentry &amp;#34;Boot using fallback initramfs&amp;#34; { &#xA;    initrd /boot/initramfs-linux-fallback.img &#xA;  } &#xA;  submenuentry &amp;#34;Boot to terminal&amp;#34; { &#xA;    add_options &amp;#34;systemd.unit=multi-user.target&amp;#34; &#xA;  }&#xA;}&#xA;&#xA;menuentry &amp;#34;Windows&amp;#34; { &#xA;   icon /EFI/refind/themes/rEFInd-minimal/icons/os_win.png &#xA;   loader \EFI\Microsoft\Boot\bootmgfw.efi &#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;挂载目录&#34;&gt;挂载目录&lt;/h3&gt;&#xA;&lt;p&gt;得益于新内核里的 ntfs3 驱动，我可以挂载一些 Windows 目录来让 Linux 上的 Wine 微信和 Steam 共享。这样前者可以同步在两个系统下的聊天记录，后者可以用 Proton 玩游戏。本来是用 fstab 挂载的，但是在过了一天之后 fstab 就没办法挂载上了，直接让系统启动不了，我感觉这非常的灵车……于是还是自己写了个 &lt;em&gt;内裤d&lt;/em&gt; 服务来挂载&lt;/p&gt;</description>
    </item>
    <item>
      <title>修复 Edge/Chrome 在 GNOME 分数缩放下的窗口位置问题</title>
      <link>https://mozz.ie/posts/fix-fractional-scaling-edge-chrome-position/</link>
      <pubDate>Sat, 27 Nov 2021 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/fix-fractional-scaling-edge-chrome-position/</guid>
      <description>&lt;p&gt;从上周开始，&lt;a href=&#34;https://www.youtube.com/watch?v=0506yDSgU7M&#34;&gt;老莱弄了个“Daily Driver CHALLENGE”&lt;/a&gt;的挑战，还弄出了装个 Steam 把桌面卸掉了的笑话，弄得众人都发笑起来 —— 当然，笑的是 Pop!_OS，不是老莱。毕竟能让一个普通用户装个包就自动把桌面卸掉，怎么想都不合理。&lt;/p&gt;&lt;p&gt;于是从11月22日开始，我也学老莱进行了 Linux 挑战，把 Linux（确切地说是 Ubuntu 21.10）作为台式的主力系统使用30天。更多细节暂时按下不表，改日再写文章细细道来。这篇文章是要介绍分数缩放下 GNOME 的一个坑，并且给出解决办法。&lt;/p&gt;&lt;p&gt;分数缩放引发的各种BUG是咱们的老熟人了，不管是Windows还是Linux，你要是但敢开125%或者150%或者225%这种缩放，那就等着被无穷无尽的BUG淹没吧：轻则画面模糊，重则弄崩桌面。这次遇到的问题是“越开越小的窗口”：在 非整数倍缩放的时候。Edge 没办法正确记忆窗口大小。准确地说，他记忆了，然后打开的时候忘了按倍数缩放...结果关了在打开，越打开越小... 看下面的视频你就明白了&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;video autoplay=&#34;autoplay&#34; loop=&#34;loop&#34; controls=&#34;controls&#34;&gt;&lt;source src=&#34;../assets/images/2021/edgebug.mp4&#34; type=&#34;video/mp4&#34;&gt;&lt;/video&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;一开始我写了个脚本用 wmctrl 在 Edge 打开的时候自动把窗口放大到原来的2倍，但是如果关闭前Edge窗口为最大化状态，再次启动时就没办法放大，因为本来就是最大化。所以换了一个思路，直接修改Edge的配置文件里记录的窗口大小和位置，启动前修改好或者关闭后修改都行。&lt;/p&gt;&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash&#xA;wininfo=$(cat ~/.config/microsoft-edge/Default/Preferences)&#xA;top=$(jq -r .browser.window_placement.top &amp;lt;&amp;lt;&amp;lt; &#34;$wininfo&#34;)&#xA;bottom=$(jq -r .browser.window_placement.bottom &amp;lt;&amp;lt;&amp;lt; &#34;$wininfo&#34;)&#xA;left=$(jq -r .browser.window_placement.left &amp;lt;&amp;lt;&amp;lt; &#34;$wininfo&#34;)&#xA;right=$(jq -r .browser.window_placement.right &amp;lt;&amp;lt;&amp;lt; &#34;$wininfo&#34;)&#xA;#echo $top,$bottom,$left,$right&#xA;if [[ ! $top -le 0 ]]; then&#xA;  top=$((top*2))&#xA;else&#xA;  top=$((top/2))&#xA;fi&#xA;if [[ ! $left -le 0 ]]; then&#xA;  left=$((left*2))&#xA;else&#xA;  left=$((left/2))&#xA;fi&#xA;cat ~/.config/microsoft-edge/Default/Preferences | jq &#39;.browser.window_placement.top=&#39;$top&#39; | .browser.window_placement.left=&#39;$left&#39; | .browser.window_placement.right=&#39;$((right*2))&#39; | .browser.window_placement.bottom=&#39;$((bottom/100*199)) &amp;gt; ~/.config/microsoft-edge/Default/PreferencesGen&#xA;mv  ~/.config/microsoft-edge/Default/PreferencesGen  ~/.config/microsoft-edge/Default/Preferences&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;想办法让上面的代码在 Edge 关闭后或者启动前运行即可，我是直接改了 /usr/bin/microsoft-edge 这个脚本。希望这个 BUG 能早日被修复。&lt;/p&gt;</description>
    </item>
    <item>
      <title>轻松抓取并解析广东电信 IPTV 全部直播源</title>
      <link>https://mozz.ie/posts/extracting-iptv-live-streams/</link>
      <pubDate>Mon, 12 Apr 2021 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/extracting-iptv-live-streams/</guid>
      <description>&lt;p&gt;&lt;strong&gt;2023年6月25日更新&lt;/strong&gt;：广东电信似乎废弃了 ChannelURL 属性，这个属性下的 RTSP 地址经测试无法播放。需改用 ChannelSDP 属性，后文代码已经同步更新，请放心使用。&lt;/p&gt;&#xA;&lt;p&gt;老爸说想在卧室看电视，网上的电视直播软件大多都不怎么稳定，还有广告。而 GitHub 上的 IPTV 项目里的源清晰度也都不咋地。自己动手，丰衣足食，自己从机顶盒里抓吧！&lt;/p&gt;&lt;p&gt;首先我们需要抓取机顶盒从开机到进入电视播放的所有数据包，怎么抓随你，网上有很多，在这里我就提供一个非常简单的思路。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;保证你的机顶盒和电脑在同一个局域网&lt;/li&gt;&lt;li&gt;电脑打开 网络连接 - 属性 - 共享，开启 “允许其他网络用户通过此计算机的 Internet 连接来连接”&lt;/li&gt;&lt;li&gt;机顶盒 - 设置 - 网络 - 静态 IP - 网关 设置为你的电脑 IP&lt;/li&gt;&lt;li&gt;打开人见人爱的 Wireshark&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;当然你想用路由器抓包之类的什么方法都可以，总之抓到包就行。&lt;/p&gt;&lt;p&gt;抓到完整过程的包之后，找到 POST /EPG/jsp/getchannellistHWCTC.jsp 这个请求&lt;/p&gt;&lt;figure class=&#34;kg-card kg-image-card&#34;&gt;&lt;img src=&#34;../assets/images/2021/04/Snipaste_2021-04-12_17-13-41.png.webp&#34; class=&#34;kg-image&#34; alt&gt;&lt;/figure&gt;&lt;p&gt;然后跟着下面找到返回包，在 Line-based text data 上右键，导出分组字节流。导出文件名就叫 channel.html&lt;/p&gt;&lt;figure class=&#34;kg-card kg-image-card&#34;&gt;&lt;img src=&#34;../assets/images/2021/04/2.png.webp&#34; class=&#34;kg-image&#34; alt&gt;&lt;/figure&gt;&lt;p&gt;用记事本或者什么编辑软件打开 channel.html ，在开头加上以下代码。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;script&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;goServicesEntry&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt;(){};&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Authentication&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{};&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;m3u8Channels&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;Authentication&lt;/span&gt;[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;CTCSetConfig&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt;(){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;regex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/,?(.+?)=&amp;#34;(.*?)&amp;#34;/gm&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;arguments&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Channel&amp;#39;&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;info&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{};&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; ((&lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;regex&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;exec&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;arguments&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;])) &lt;span style=&#34;color:#f92672&#34;&gt;!==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;regex&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;regex&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ChannelName&amp;#34;&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;m3u8Channels&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;#EXTINF:-1 tvg-name=\&amp;#34;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;\&amp;#34;,&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ChannelSDP&amp;#34;&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;m3u8Channels&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;setTimeout&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt;(){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; window.document.&lt;span style=&#34;color:#a6e22e&#34;&gt;createElement&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;href&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; window.&lt;span style=&#34;color:#a6e22e&#34;&gt;URL&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;createObjectURL&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Blob&lt;/span&gt;([&lt;span style=&#34;color:#a6e22e&#34;&gt;m3u8Channels&lt;/span&gt;], {&lt;span style=&#34;color:#a6e22e&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;application/x-mpegURL&amp;#39;&lt;/span&gt;}));&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;download&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;IPTV.m3u8&amp;#39;&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  document.&lt;span style=&#34;color:#a6e22e&#34;&gt;body&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;appendChild&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;click&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  document.&lt;span style=&#34;color:#a6e22e&#34;&gt;body&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;removeChild&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  },&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;/script&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后拉到文件最下面找到 &lt;code&gt;goServicesEntry()&lt;/code&gt;，把整个函数（如下图中的1178 - 1181行）删掉&lt;/p&gt;</description>
    </item>
    <item>
      <title>虚拟显示器终极解决方案 IndirectDisplay</title>
      <link>https://mozz.ie/posts/ultimate-virtual-monitor-solution-indirect-display/</link>
      <pubDate>Sun, 11 Apr 2021 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/ultimate-virtual-monitor-solution-indirect-display/</guid>
      <description>&lt;p&gt;自从上了大学，因为学校到家的距离不算远，所以我经常两头跑。别人两头跑带个笔记本也就好了；我虽然也背着个重的一笔还有1060独显的SB2回家，但是还是经常有访问放在学校的PC的需求。&lt;/p&gt;&#xA;&lt;p&gt;有需求就要解决，一开始我用的就是普通的RDP；RDP好是好，但是他没法调用显卡也没法打游戏，图像压缩算法也不适合串流。所以自然要掏出云游戏神器 &lt;a href=&#34;https://parsec.app/&#34;&gt;Parsec&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;什么，你问我为啥要串流回学校打游戏？主要有三点，一是家里的电脑E3+Vega64虽然还能打不少游戏，但是肯定比不上3700X+2080；二是学校有千兆对等，这么高的上传不用一用就感觉很亏；三是因为我就是想折腾一下。&lt;/p&gt;&#xA;&lt;p&gt;&#xA;    原因介绍完了，该掏出 Parsec 了。Parsec 以及 Moonlight、Steam&#xA;    等等一系列游戏串流软件都有一个问题就是你必须有一个能输出的显示器他才能抓取到视频流，不然就是黑屏。我总不能一直把宿舍的显示器打开，方便全体舍友随时视奸我在干嘛吧。那么就得虚拟一个显示器（Dummy Display / Fake Display），无非五种方案：&#xA;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;    &lt;li&gt;专业级显卡直接支持添加 EDID Profile 来虚拟显示器（NVIDIA GRID）&lt;/li&gt;&#xA;    &lt;li&gt;用 HDMI 诱骗器（假负载），淘宝十五一个&lt;/li&gt;&#xA;    &lt;li&gt;SplashTop、VNC 的虚拟显示器（不清楚具体实现）&lt;/li&gt;&#xA;    &lt;li&gt;Windows 10 1607 之前的系统可以通过强制 VGA 输出（如图）&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;figure class=&#34;kg-card kg-image-card kg-card-hascaption&#34;&gt;&#xA;    &lt;img src=&#34;../assets/images/2021/04/Snipaste_2021-04-11_23-13-29.png.webp&#34; class=&#34;kg-image&#34; alt /&gt;&#xA;    &lt;figcaption&gt;图源：CSDN &lt;a href=&#34;https://blog.csdn.net/fanxiushu&#34; rel=&#34;noopener&#34;&gt;雨中风华&lt;/a&gt;&lt;/figcaption&gt;&#xA;&lt;/figure&gt;&#xA;&lt;ul&gt;&#xA;    &lt;li&gt;Windows 10 的 Indirect Display&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;有钱人选第一种，穷一点的选第二种；第三种我从来没成功过但是 AJ 大哥说可以；第四种没试过；而今天要说的就是第五种。&lt;/p&gt;&#xA;&lt;figure class=&#34;kg-card kg-image-card&#34;&gt;&#xA;    &lt;img&#xA;        src=&#34;../assets/images/2021/04/Snipaste_2021-04-11_23-19-30.png.webp&#34;&#xA;        class=&#34;kg-image&#34;&#xA;        alt&#xA;        srcset=&#34;../assets/images/size/w600/2021/04/Snipaste_2021-04-11_23-19-30.png.webp 600w, ../assets/images/2021/04/Snipaste_2021-04-11_23-19-30.png.webp 644w&#34;&#xA;    /&gt;&#xA;&lt;/figure&gt;&#xA;&lt;p&gt;事情的一开始就是 AJ 跟我说他找到了一个&lt;a href=&#34;https://www.amyuni.com/forum/viewtopic.php?t=3030&#34;&gt;很不错的虚拟屏幕驱动&lt;/a&gt;，我尝试了一下，确实很好用，但是只有一个问题：固定了1920x1080分辨率&lt;/p&gt;&#xA;&lt;p&gt;接下来我就掏出 IDA 对着这个驱动 usbmmIdd.dll 一顿艹，强行把里面的1920x1080改成3840x2160，结果我获得了一个没有分辨率模式选择的显示器&lt;/p&gt;&#xA;&lt;figure class=&#34;kg-card kg-image-card kg-card-hascaption&#34;&gt;&#xA;    &lt;img&#xA;        src=&#34;../assets/images/2021/04/QQ--20210411232208.jpg.webp&#34;&#xA;        class=&#34;kg-image&#34;&#xA;        alt&#xA;        srcset=&#34;../assets/images/size/w600/2021/04/QQ--20210411232208.jpg.webp 600w, ../assets/images/2021/04/QQ--20210411232208.jpg.webp 841w&#34;&#xA;        sizes=&#34;(min-width: 720px) 720px&#34;&#xA;    /&gt;&#xA;    &lt;figcaption&gt;显然不能用&lt;/figcaption&gt;&#xA;&lt;/figure&gt;&#xA;&lt;p&gt;既然直接修改没法用，那就尝试探究一下原理吧，我在它的 inf 里看到了这么一段注释&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;; usbmmm.inf&#xA;;&#xA;; Installation inf for the USB Mobile Monitor Indirect Display Adapater&#xA;; http://www.usbmobilemonitor.com&#xA;; Copyright Amyuni Technologies: http://www.amyuni.com&#xA;;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;其中这个 Indirect Display 吸引了我，经过鸟姐姐的提醒我找到了微软官方的 &lt;a href=&#34;https://github.com/microsoft/Windows-driver-samples/tree/master/video/IndirectDisplay&#34;&gt;Indirect Display Sample&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>基于PVE的新网络架构 - 踩坑回顾</title>
      <link>https://mozz.ie/posts/pve-based-home-network/</link>
      <pubDate>Sat, 06 Mar 2021 00:00:00 +0000</pubDate>
      <guid>https://mozz.ie/posts/pve-based-home-network/</guid>
      <description>&lt;p&gt;我美好的寒假的第一天，毁于那多灾多难的 OpenWRT：当我第七七四十九次折腾 OpenWRT 上的隧道而他又莫名其妙的开始爆炸时，我怒了。&lt;/p&gt;&lt;figure class=&#34;kg-card kg-image-card kg-card-hascaption&#34;&gt;&lt;img src=&#34;../assets/images/2021/03/image.png.webp&#34; class=&#34;kg-image&#34; alt srcset=&#34;../assets/images/size/w600/2021/03/image.png.webp 600w, ../assets/images/size/w1000/2021/03/image.png.webp 1000w, ../assets/images/2021/03/image.png.webp 1280w&#34; sizes=&#34;(min-width: 720px) 720px&#34;&gt;&lt;figcaption&gt;说的就是你，xl2tpd&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;我实在是搞不明白，在 Windows 下面轻轻松松跑个三四百兆的 L2TP 连接，怎么到了 OpenWRT 上下载就只有 20M 不到，上传一跑直接爆炸。&lt;/p&gt;&lt;p&gt;冥冥之中，有一股神秘的声音（其实是西瓜）在我耳畔低语：为什么不试试上虚拟化的 RouterOS 呢？&lt;/p&gt;&lt;p&gt;尽管西瓜一再抨击 Proxmox VE 而向我推销他的 Xen，但是因为我对 PVE 更加熟悉，最后还是选择了 PVE （事实证明这是好的）&lt;/p&gt;&lt;p&gt;于是我做出了初步的计划：在 PVE 上跑 RouterOS + OpenWRT；RouterOS 负责打隧道（PPPoE、L2TP、PPTP、GRE），OpenWRT 负责做透明代理；用 DHCP 对不同的设备分配不同的网关达到分流和故障控制的效果。&lt;/p&gt;&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;上网下了一个PVE，找了一个 6.44.2 的 L5 授权破解版（和卖盗版电子盘的原理有异曲同工之妙，都是改硬盘序列号），写盘、装系统、部署一气呵成，&lt;s&gt;是 BGP Player 中的豪杰&lt;/s&gt;。&lt;/p&gt;&#xA;&lt;p&gt;后续 AJ 大哥告诉我 CHR 版本也可以无限白嫖，是一个更好的选择，不过这时候我已经配好了，反正都是一样的用，如果没有什么安全问题就不换 CHR 了。&lt;/p&gt;&#xA;&lt;!--kg-card-end: markdown--&gt;&lt;p&gt;RouterOS 的配置十分简单便捷，J1900 软路由的四个接口分别对应一个 Linux Bridge 再分配到 ROS 的 VM 上就行了。在这个阶段我只踩到了一个坑：ether5 上的 vlan33 里面有一台主机 192.168.6.99，但是我给 vlan33 配了 192.168.6.1/24 之后还是 ping 不通这台机子，torch 能看到这台机子往外发包。排查了十分钟之后我把接口的 loop detect 给关了，问题解决。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
